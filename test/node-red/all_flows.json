[{"id":"a9cd486b.1eae08","type":"tab","label":"api testing","disabled":false,"info":""},{"id":"cdf3f2b6.0eb2c","type":"tab","label":"dashboard layout","disabled":false,"info":""},{"id":"35d1168f.5e149a","type":"tab","label":"pulse [tab]","disabled":false,"info":""},{"id":"1ada8ef0.ecb681","type":"tab","label":"motes/testboxes [2*tab]","disabled":false,"info":""},{"id":"cdc49e9a.21798","type":"tab","label":"reprogram [tab]","disabled":false,"info":""},{"id":"88b2925f.b1503","type":"tab","label":"screen [tab]","disabled":false,"info":""},{"id":"bf627e8b.92875","type":"tab","label":"admin [tab]","disabled":false,"info":""},{"id":"327ef5a1.b4c91a","type":"mqtt-broker","z":"","broker":"argus.paris.inria.fr","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"720a5dcd.cf7c44","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#8000ff","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#8000ff","edited":true},"page-titlebar-backgroundColor":{"value":"#8000ff","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#a64dff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#8000ff","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"OpenTestbed","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"5ac34041.fc405","type":"ui_tab","z":"","name":"reprogram","icon":"dashboard","order":4},{"id":"c97b98ef.8bcaf8","type":"ui_group","z":"","name":"select mote","tab":"5ac34041.fc405","order":1,"disp":false,"width":"6","collapse":false},{"id":"cf023360.ebfda","type":"ui_group","z":"","name":"reprogram","tab":"5ac34041.fc405","order":2,"disp":false,"width":"12","collapse":false},{"id":"d6820b05.c88058","type":"ui_tab","z":"","name":"pulse","icon":"dashboard","order":1},{"id":"e775eb81.98b258","type":"ui_group","z":"","name":"messages per minute","tab":"d6820b05.c88058","order":1,"disp":true,"width":"6","collapse":false},{"id":"e4f823b9.d07f7","type":"ui_group","z":"","name":"messages per box","tab":"d6820b05.c88058","order":2,"disp":true,"width":"6","collapse":false},{"id":"50e811bf.06996","type":"ui_group","z":"","name":"messages per mote","tab":"d6820b05.c88058","order":4,"disp":true,"width":"6","collapse":false},{"id":"15598a70.f8cd36","type":"ui_group","z":"","name":"messages per type","tab":"d6820b05.c88058","order":3,"disp":true,"width":"6","collapse":false},{"id":"84d51737.06dbe8","type":"ui_tab","z":"","name":"screen","icon":"dashboard","order":5},{"id":"eeeeebc9.9631d8","type":"ui_group","z":"","name":"screen","tab":"84d51737.06dbe8","disp":false,"width":"12","collapse":false},{"id":"6ee39175.cd7c","type":"ui_tab","z":"","name":"admin","icon":"dashboard","order":6},{"id":"83be9e0b.566e4","type":"ui_group","z":"","name":"discover","tab":"6ee39175.cd7c","order":2,"disp":true,"width":"6","collapse":false},{"id":"6155f4f4.5e5e1c","type":"ui_group","z":"","name":"password","tab":"6ee39175.cd7c","order":1,"disp":true,"width":"6","collapse":false},{"id":"ae851dba.90359","type":"ui_group","z":"1ada8ef0.ecb681","name":"mote list","tab":"4bece691.2918d8","order":2,"disp":false,"width":"19","collapse":false},{"id":"4bece691.2918d8","type":"ui_tab","z":"1ada8ef0.ecb681","name":"motes","icon":"dashboard","order":2},{"id":"ec4a186.40383e8","type":"ui_tab","z":"","name":"testboxes","icon":"dashboard","order":3},{"id":"7a042b3f.39c6e4","type":"ui_group","z":"","name":"testbox list","tab":"ec4a186.40383e8","order":2,"disp":false,"width":"19","collapse":false},{"id":"f093060.adc0ff8","type":"ui_group","z":"","name":"mote refresh","tab":"4bece691.2918d8","order":1,"disp":false,"width":"3","collapse":false},{"id":"5b0686e2.1da1b8","type":"ui_group","z":"","name":"testbox refresh","tab":"ec4a186.40383e8","order":1,"disp":false,"width":"3","collapse":false},{"id":"1b9efa56.a65a36","type":"ui_group","z":"","name":"Default","tab":"6dbaf4d.bd7c30c","order":1,"disp":false,"width":"24","collapse":false},{"id":"6dbaf4d.bd7c30c","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"5c396642.811d08","type":"ui_group","z":"","name":"Feedback","tab":"5ac34041.fc405","order":3,"disp":false,"width":"6","collapse":false},{"id":"1ffb0ee3.87ba21","type":"ui_group","z":"","name":"change location","tab":"6ee39175.cd7c","order":3,"disp":true,"width":"6","collapse":false},{"id":"74a41da5.b12ae4","type":"inject","z":"a9cd486b.1eae08","name":"discovermotes","topic":"discovermotes","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":155,"y":380,"wires":[["dcbfbfb5.133b1"]]},{"id":"2ce7289c.a82fd8","type":"inject","z":"a9cd486b.1eae08","name":"status","topic":"status","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":135,"y":340,"wires":[["cfc29e04.6933d"]]},{"id":"f666167a.6c0aa8","type":"mqtt in","z":"a9cd486b.1eae08","name":"argus","topic":"opentestbed/#","qos":"2","broker":"327ef5a1.b4c91a","x":110,"y":200,"wires":[["82dbfd10.545d8"]]},{"id":"eb4ad80a.7e38a8","type":"mqtt out","z":"a9cd486b.1eae08","name":"argus","topic":"","qos":"","retain":"","broker":"327ef5a1.b4c91a","x":710,"y":560,"wires":[]},{"id":"41c2a11.1cc226","type":"function","z":"a9cd486b.1eae08","name":"topic","func":"var topic  = global.get('topic_box')\ntopic     += msg.topic\nmsg.topic  = topic\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":420,"wires":[["9099026f.4e885"]]},{"id":"b22feac2.194608","type":"inject","z":"a9cd486b.1eae08","name":"echo","topic":"echo","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":135,"y":300,"wires":[["dd4f16c5.48c328"]]},{"id":"d38b1f66.a7979","type":"inject","z":"a9cd486b.1eae08","name":"changesoftware","topic":"changesoftware","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":165,"y":420,"wires":[["f173355f.3e6a28"]]},{"id":"f173355f.3e6a28","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n    'version': 'REL-1.0.0',\n    'url':     'https://github.com/openwsn-berkeley/opentestbed/archive/develop.zip'\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":340,"y":420,"wires":[["41c2a11.1cc226"]]},{"id":"9347a8ec.2d6908","type":"comment","z":"a9cd486b.1eae08","name":"box commands","info":"","x":100,"y":260,"wires":[]},{"id":"12d1dee7.9eada1","type":"comment","z":"a9cd486b.1eae08","name":"mote commands","info":"","x":100,"y":635,"wires":[]},{"id":"dd4f16c5.48c328","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n    'payload': 'some random payload'   \n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":300,"wires":[["41c2a11.1cc226"]]},{"id":"6d4328c0.3258b8","type":"inject","z":"a9cd486b.1eae08","name":"picturetoscreen","topic":"picturetoscreen","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":165,"y":460,"wires":[["5c5ae4a3.870eec"]]},{"id":"5c5ae4a3.870eec","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n    //'url':     'https://upload.wikimedia.org/wikipedia/en/7/7d/Lenna_%28test_image%29.png',\n    'url':     'https://openwsn.atlassian.net/wiki/download/thumbnails/25231521/background_tabletop.jpg?version=1&modificationDate=1449413979021&cacheVersion=1&api=v2&width=500&height=375',\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":460,"wires":[["41c2a11.1cc226"]]},{"id":"13c63c35.61ad94","type":"inject","z":"a9cd486b.1eae08","name":"colortoscreen","topic":"colortoscreen","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":155,"y":500,"wires":[["cf3c29d0.614ae8"]]},{"id":"cf3c29d0.614ae8","type":"function","z":"a9cd486b.1eae08","name":"payload`","func":"msg.payload = {\n    'r': 0, \n    'g': 0,\n    'b': 255,\n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":500,"wires":[["41c2a11.1cc226"]]},{"id":"1d026c43.b0d4c4","type":"inject","z":"a9cd486b.1eae08","name":"program url","topic":"program","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":155,"y":675,"wires":[["29dca3a5.81a89c"]]},{"id":"29dca3a5.81a89c","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n    'description':     '01bsp_leds_prog',\n    //'url':             'https://raw.githubusercontent.com/openwsn-berkeley/opentestbed/master/bootloaders/01bsp_eui64_prog.ihex'\n    'url':           'https://drive.google.com/uc?authuser=0&id=1kVbumj-JB55yNtZrI5dJcrOOXQpCF_tr&export=download'\n    //'url': 'https://raw.githubusercontent.com/openwsn-berkeley/opentestbed/develop/bootloaders/01bsp_leds_prog.ihex'\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":340,"y":675,"wires":[["7144c372.153e2c"]]},{"id":"8fa776f2.7eb8b8","type":"inject","z":"a9cd486b.1eae08","name":"program hex","topic":"program","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":155,"y":715,"wires":[["669a73ff.18cc3c"]]},{"id":"669a73ff.18cc3c","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n    'description': '01bsp_leds_prog.ihex',\n    'hex':         ''\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":340,"y":715,"wires":[["7144c372.153e2c"]]},{"id":"9099026f.4e885","type":"function","z":"a9cd486b.1eae08","name":"token","func":"msg.payload.token = 123\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":560,"wires":[["eb4ad80a.7e38a8"]]},{"id":"7144c372.153e2c","type":"function","z":"a9cd486b.1eae08","name":"topic","func":"var topic  = global.get('topic_mote')\ntopic     += msg.topic\nmsg.topic  = topic\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":755,"wires":[["9099026f.4e885"]]},{"id":"70b6f528.01554c","type":"inject","z":"a9cd486b.1eae08","name":"tomoteserialbytes","topic":"tomoteserialbytes","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":165,"y":755,"wires":[["522aea98.6bbd64"]]},{"id":"522aea98.6bbd64","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n    'serialbytes': [255,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108,255,108,255,255,108,255,255,108]\n    \n}\nreturn msg;\n","outputs":1,"noerr":0,"x":340,"y":755,"wires":[["7144c372.153e2c"]]},{"id":"99811a9.d132ee8","type":"inject","z":"a9cd486b.1eae08","name":"reset","topic":"reset","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":135,"y":795,"wires":[["7c785036.201ab"]]},{"id":"d8b27fbf.a1908","type":"inject","z":"a9cd486b.1eae08","name":"disable","topic":"disable","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":135,"y":835,"wires":[["2ffd1f8f.2a8e4"]]},{"id":"cfc29e04.6933d","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":340,"wires":[["41c2a11.1cc226"]]},{"id":"dcbfbfb5.133b1","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":380,"wires":[["41c2a11.1cc226"]]},{"id":"82dbfd10.545d8","type":"json","z":"a9cd486b.1eae08","name":"","property":"payload","action":"obj","pretty":false,"x":235,"y":200,"wires":[["52bfbf4.e23c84"]]},{"id":"7c785036.201ab","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":795,"wires":[["7144c372.153e2c"]]},{"id":"2ffd1f8f.2a8e4","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":835,"wires":[["7144c372.153e2c"]]},{"id":"bf901abd.e4d738","type":"function","z":"a9cd486b.1eae08","name":"set topic","func":"var topic  = 'opentestbed'\ntopic     += '/deviceType/box/deviceId/'\ntopic     += msg.payload\ntopic     += '/cmd/'\nmsg.topic  = topic\nglobal.set(\"topic_box\", topic)\nreturn msg","outputs":1,"noerr":0,"x":365,"y":60,"wires":[["bbd93b48.353c58"]]},{"id":"6ef26552.0c573c","type":"inject","z":"a9cd486b.1eae08","name":"select target box","topic":"","payload":"all","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"0.01","x":175,"y":60,"wires":[["bf901abd.e4d738"]]},{"id":"d6bd0a75.2dd938","type":"function","z":"a9cd486b.1eae08","name":"set topic","func":"var topic  = 'opentestbed'\ntopic     += '/deviceType/mote/deviceId/'\ntopic     += msg.payload\ntopic     += '/cmd/'\nmsg.topic  = topic\nglobal.set(\"topic_mote\", topic)\nreturn msg","outputs":1,"noerr":0,"x":365,"y":100,"wires":[["f4fa69b0.5e5eb8"]]},{"id":"dc64d28e.479f8","type":"inject","z":"a9cd486b.1eae08","name":"select target mote","topic":"","payload":"all","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"0.01","x":175,"y":100,"wires":[["d6bd0a75.2dd938"]]},{"id":"52bfbf4.e23c84","type":"function","z":"a9cd486b.1eae08","name":"extract message type","func":"// extract message type\nvar temp    = msg.topic.split('/')\nvar msgtype = temp[6]\n\nswitch (msgtype) {\n    case 'heartbeat':\n        return [msg,null,null,null];\n    case 'fromoteserialbytes':\n        return [null,msg,null,null];\n    case 'picturetoscreen':\n        return [null,null,msg,null];\n    default:\n        return [null,null,null,msg];\n}\n\n","outputs":4,"noerr":0,"x":415,"y":200,"wires":[["e7bfe7de.2da858"],["d2ade0d9.d3086"],["5305cfe.e08d53"],["ac9d65ef.e210e8"]]},{"id":"e7bfe7de.2da858","type":"debug","z":"a9cd486b.1eae08","name":"heartbeat","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":620,"y":140,"wires":[]},{"id":"ac9d65ef.e210e8","type":"debug","z":"a9cd486b.1eae08","name":"others","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":610,"y":260,"wires":[]},{"id":"d2ade0d9.d3086","type":"debug","z":"a9cd486b.1eae08","name":"fromoteserialbytes","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":180,"wires":[]},{"id":"3c2c034d.96d3bc","type":"inject","z":"a9cd486b.1eae08","name":"hostnametoscreen","topic":"hostnametoscreen","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":175,"y":540,"wires":[["fccbaf0c.7be0f"]]},{"id":"fccbaf0c.7be0f","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":540,"wires":[["41c2a11.1cc226"]]},{"id":"bbd93b48.353c58","type":"debug","z":"a9cd486b.1eae08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":565,"y":60,"wires":[]},{"id":"f4fa69b0.5e5eb8","type":"debug","z":"a9cd486b.1eae08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":565,"y":100,"wires":[]},{"id":"c726f6c6.6aecd8","type":"comment","z":"a9cd486b.1eae08","name":"configuration","info":"","x":90,"y":20,"wires":[]},{"id":"be1125b0.26e5b8","type":"function","z":"cdc49e9a.21798","name":"","func":"flow.set('eui64list',[])\n\nmsg.topic   = 'opentestbed/deviceType/box/deviceId/all/cmd/status'\nmsg.payload = {\n    'token': 123,\n}\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":80,"wires":[["5f1539a2.e209d8"]]},{"id":"5f1539a2.e209d8","type":"mqtt out","z":"cdc49e9a.21798","name":"argus","topic":"","qos":"","retain":"","broker":"327ef5a1.b4c91a","x":750,"y":100,"wires":[]},{"id":"1ffc1777.18c369","type":"ui_button","z":"cdc49e9a.21798","name":"refresh","group":"c97b98ef.8bcaf8","order":2,"width":0,"height":0,"passthru":false,"label":"refresh mote list","color":"black","bgcolor":"white","icon":"refresh","payload":"","payloadType":"str","topic":"discovermotes","x":240,"y":80,"wires":[["be1125b0.26e5b8"]]},{"id":"758883c3.5b841c","type":"mqtt in","z":"cdc49e9a.21798","name":"argus","topic":"opentestbed/#","qos":"2","broker":"327ef5a1.b4c91a","x":65,"y":240,"wires":[["c841aafb.b04068"]]},{"id":"10205700.9db849","type":"function","z":"cdc49e9a.21798","name":"populate eui64list","func":"var splittopic = msg.topic.split('/')\n\nif (splittopic[5]==='resp' && splittopic[6]==='status') {\n    // get flow variable\n    var eui64list  = flow.get('eui64list')\n    \n    // add motes from this status response\n    for (var i = 0; i < msg.payload.returnVal.motes.length; i++) {\n        eui64list.push(msg.payload.returnVal.motes[i].EUI64);\n    }\n    \n    // update flow variable\n    flow.set('eui64list',eui64list)\n    \n    // create options for dropdown\n    var options = []\n    options.push('all')\n    for (var i = 0; i < eui64list.length; i++) {\n        options.push(eui64list[i]);\n    }\n    msg.options = options;\n    msg.payload = 'all';\n    \n    return msg;\n}\n\n\n","outputs":1,"noerr":0,"x":410,"y":320,"wires":[["a473502c.b151"]]},{"id":"a473502c.b151","type":"ui_dropdown","z":"cdc49e9a.21798","name":"","label":"motes list","place":"select mote to reprogram","group":"c97b98ef.8bcaf8","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"","value":"all","type":"str"}],"payload":"","topic":"","x":620,"y":380,"wires":[["bf0eb115.ffa91"]]},{"id":"d3a89ef9.b54fe","type":"ui_text_input","z":"cdc49e9a.21798","name":"URL binary","label":"URL to binary","group":"cf023360.ebfda","order":2,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":310,"y":540,"wires":[["5ebcb707.aa1408"]]},{"id":"bf0eb115.ffa91","type":"function","z":"cdc49e9a.21798","name":"store eui64toprogram","func":"flow.set('eui64toprogram',msg.payload)\n","outputs":1,"noerr":0,"x":820,"y":380,"wires":[[]]},{"id":"5ebcb707.aa1408","type":"function","z":"cdc49e9a.21798","name":"store urlbinary","func":"flow.set('urlbinary',msg.payload)\n","outputs":1,"noerr":0,"x":500,"y":540,"wires":[[]]},{"id":"d65ec53.7407938","type":"function","z":"cdc49e9a.21798","name":"admin","func":"flow.set('motes_program_ok',0)\nflow.set('motes_program_notok',0)\nmsg.motes_program_ok    = 0\nmsg.motes_program_notok = 0\nmsg.topic   = 'opentestbed/deviceType/mote/deviceId/'+flow.get('eui64toprogram')+'/cmd/program'\nmsg.payload = {\n    'description':   flow.get('firmware_description'),\n    'url':           flow.get('urlbinary'),\n    'token':         123,\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":450,"y":120,"wires":[["5f1539a2.e209d8","589a5d17.8617f4","45a9bd87.116094"]]},{"id":"5ab124af.3e25fc","type":"ui_button","z":"cdc49e9a.21798","name":"program","group":"cf023360.ebfda","order":3,"width":0,"height":0,"passthru":false,"label":"program","color":"black","bgcolor":"white","icon":"","payload":"","payloadType":"str","topic":"","x":240,"y":120,"wires":[["d65ec53.7407938"]]},{"id":"1f3fd319.32554d","type":"comment","z":"cdc49e9a.21798","name":"buttons","info":"","x":210,"y":40,"wires":[]},{"id":"c4b1438.e8a61c","type":"comment","z":"cdc49e9a.21798","name":"dropdown","info":"","x":220,"y":160,"wires":[]},{"id":"55d5c5db.5b1dcc","type":"comment","z":"cdc49e9a.21798","name":"populate","info":"","x":260,"y":200,"wires":[]},{"id":"20583d44.8f9882","type":"comment","z":"cdc49e9a.21798","name":"urlbinary","info":"","x":260,"y":500,"wires":[]},{"id":"b7738a0d.bc8f28","type":"comment","z":"cdc49e9a.21798","name":"use","info":"","x":590,"y":340,"wires":[]},{"id":"1bc16a6f.f85d86","type":"comment","z":"a9cd486b.1eae08","name":"snooping MQTT","info":"","x":100,"y":140,"wires":[]},{"id":"c817d450.a6fcf8","type":"ui_gauge","z":"35d1168f.5e149a","name":"messages per minute","group":"e775eb81.98b258","order":0,"width":0,"height":0,"gtype":"gage","title":"","label":"","format":"{{value}}","min":"4000","max":"5000","colors":["#ca3838","#00b500","#ca3838"],"seg1":"4200","seg2":"4800","x":460,"y":120,"wires":[]},{"id":"d6f40938.f144e8","type":"mqtt in","z":"35d1168f.5e149a","name":"argus","topic":"opentestbed/#","qos":"2","broker":"327ef5a1.b4c91a","x":90,"y":40,"wires":[["c4b06d61.45afd","72860fd6.73f49","fcf1be50.5670c"]]},{"id":"c4b06d61.45afd","type":"msg-speed","z":"35d1168f.5e149a","name":"","frequency":"min","estimation":false,"ignore":true,"x":130,"y":140,"wires":[["c817d450.a6fcf8","8b94fd6e.7e6fb"],[]]},{"id":"8b94fd6e.7e6fb","type":"ui_chart","z":"35d1168f.5e149a","name":"messages per minute","group":"e775eb81.98b258","order":0,"width":0,"height":0,"label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":460,"y":160,"wires":[[],[]]},{"id":"72860fd6.73f49","type":"function","z":"35d1168f.5e149a","name":"count per deviceType/deviceId","func":"// extract deviceType and deviceId from message\nvar temp = msg.topic.split('/')\nvar deviceType = temp[2]\nvar deviceId   = temp[4]\n\nvar numperid = flow.get('numperid') || {};\n\nif(numperid.hasOwnProperty(deviceType)===false) {\n    numperid[deviceType] = {};\n}\nif(numperid[deviceType].hasOwnProperty(deviceId)===false) {\n    numperid[deviceType][deviceId] = 0;\n}\nnumperid[deviceType][deviceId]++;\n\n\nflow.set('numperid',numperid)\n\nmsg.topic   = deviceId;\nmsg.payload = numperid[deviceType][deviceId];\n\nswitch(deviceType) {\n    case 'box':\n        return [msg,null];\n    case 'mote':\n        return [null,msg];\n}","outputs":2,"noerr":0,"x":190,"y":260,"wires":[["3696f21c.d451ae"],["135f4c10.b90674"]]},{"id":"3696f21c.d451ae","type":"ui_chart","z":"35d1168f.5e149a","name":"messages per box","group":"e4f823b9.d07f7","order":0,"width":"5","height":"10","label":"","chartType":"horizontalBar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":450,"y":200,"wires":[[],[]]},{"id":"135f4c10.b90674","type":"ui_chart","z":"35d1168f.5e149a","name":"messages per mote","group":"50e811bf.06996","order":0,"width":"5","height":"10","label":"","chartType":"horizontalBar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":450,"y":280,"wires":[[],[]]},{"id":"e3163307.d3407","type":"ui_button","z":"35d1168f.5e149a","name":"reset messages per box","group":"e4f823b9.d07f7","order":0,"width":"2","height":"1","passthru":false,"label":"reset","color":"black","bgcolor":"white","icon":"replay","payload":"","payloadType":"str","topic":"","x":470,"y":240,"wires":[["deaa4f7b.6b78b"]]},{"id":"deaa4f7b.6b78b","type":"function","z":"35d1168f.5e149a","name":"","func":"var numperid = flow.get('numperid')\nnumperid['box'] = {}\nflow.set('numperid',numperid)","outputs":1,"noerr":0,"x":670,"y":240,"wires":[[]]},{"id":"507a938c.a3d91c","type":"function","z":"35d1168f.5e149a","name":"","func":"var numperid = flow.get('numperid')\nnumperid['mote'] = {}\nflow.set('numperid',numperid)","outputs":1,"noerr":0,"x":670,"y":320,"wires":[[]]},{"id":"ae6984d9.76ce08","type":"ui_button","z":"35d1168f.5e149a","name":"reset messages per mote","group":"50e811bf.06996","order":0,"width":"2","height":"1","passthru":false,"label":"reset","color":"black","bgcolor":"white","icon":"replay","payload":"","payloadType":"str","topic":"","x":470,"y":320,"wires":[["507a938c.a3d91c"]]},{"id":"fcf1be50.5670c","type":"function","z":"35d1168f.5e149a","name":"count per messages type","func":"// extract message type\nvar temp = msg.topic.split('/')\nvar type = temp[5]+'.'+temp[6]\n\nvar numpertype = flow.get('numpertype') || {};\n\nif(numpertype.hasOwnProperty(type)===false) {\n    numpertype[type] = 0;\n}\nnumpertype[type]++;\n\nmsg.topic   = type;\nmsg.payload = numpertype[type];\n\nflow.set('numpertype',numpertype)\n\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":360,"wires":[["e48d648f.eb5468"]]},{"id":"e48d648f.eb5468","type":"ui_chart","z":"35d1168f.5e149a","name":"messages per type","group":"15598a70.f8cd36","order":0,"width":"5","height":"10","label":"","chartType":"horizontalBar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":450,"y":360,"wires":[[],[]]},{"id":"95602dbd.5553","type":"function","z":"35d1168f.5e149a","name":"","func":"flow.set('numpertype',{})\n","outputs":1,"noerr":0,"x":670,"y":400,"wires":[[]]},{"id":"42068530.41b2cc","type":"ui_button","z":"35d1168f.5e149a","name":"reset messages per type","group":"15598a70.f8cd36","order":0,"width":"2","height":"1","passthru":false,"label":"reset","color":"black","bgcolor":"white","icon":"replay","payload":"","payloadType":"str","topic":"","x":470,"y":400,"wires":[["95602dbd.5553"]]},{"id":"6afb83b3.55626c","type":"inject","z":"88b2925f.b1503","name":"","topic":"","payload":"","payloadType":"date","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":60,"wires":[["9dd22dec.5065"]]},{"id":"9dd22dec.5065","type":"function","z":"88b2925f.b1503","name":"rotator","func":"allpics = [\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/A.png',\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/B.png',\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/C.png',\n    //'http://pdmp2017.iecl.univ-lorraine.fr/pic/inria.png',\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/D.png',\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/E.png',\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/F.png',\n    //'https://team.inria.fr/eva/files/2015/11/logo_eva_full.png',\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/G.png',\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/H.png',\n    'https://openwsn.atlassian.net/wiki/download/attachments/25231521/I.png',\n    //'https://upload.wikimedia.org/wikipedia/en/7/7d/Lenna_%28test_image%29.png',\n]\n\nvar picidx = flow.get('picidx') || 0;\npicidx = (picidx+1)%allpics.length;\nflow.set('picidx',picidx);\n\nmsg.payload = allpics[picidx]\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":60,"wires":[["1483075a.9ece89","cc977719.48b4e8"]]},{"id":"25dc4694.3aa21a","type":"mqtt out","z":"88b2925f.b1503","name":"argus","topic":"","qos":"","retain":"","broker":"327ef5a1.b4c91a","x":650,"y":100,"wires":[]},{"id":"7c485db6.d82bb4","type":"ui_text_input","z":"88b2925f.b1503","name":"url image","label":"replace by image at this URL:","group":"eeeeebc9.9631d8","order":2,"width":"0","height":"0","passthru":true,"mode":"text","delay":"1","topic":"","x":100,"y":120,"wires":[["a142585.35e88a8"]]},{"id":"e9a2dcbf.4d127","type":"ui_button","z":"88b2925f.b1503","name":"display button","group":"eeeeebc9.9631d8","order":3,"width":0,"height":0,"passthru":false,"label":"display on all testboxes","color":"black","bgcolor":"white","icon":"portrait","payload":"","payloadType":"str","topic":"","x":120,"y":160,"wires":[["85e2460e.3f5ef8"]]},{"id":"a142585.35e88a8","type":"function","z":"88b2925f.b1503","name":"store","func":"flow.set('url_pic',msg.payload)\n","outputs":1,"noerr":0,"x":270,"y":120,"wires":[[]]},{"id":"1483075a.9ece89","type":"function","z":"88b2925f.b1503","name":"format message","func":"msg.topic   = 'opentestbed/deviceType/box/deviceId/all/cmd/picturetoscreen'\nmsg.payload = {\n    'url':   msg.payload,\n    'token': 'picrotator',\n}\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":100,"wires":[["25dc4694.3aa21a"]]},{"id":"85e2460e.3f5ef8","type":"function","z":"88b2925f.b1503","name":"store","func":"msg.payload = flow.get('url_pic')\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":160,"wires":[["1483075a.9ece89","cc977719.48b4e8"]]},{"id":"cc977719.48b4e8","type":"ui_template","z":"88b2925f.b1503","group":"eeeeebc9.9631d8","name":"currently showing","order":1,"width":"10","height":"8","format":"Currently showing on the screen of all testboxes:\n<img src={{msg.payload}}>","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":490,"y":160,"wires":[[]]},{"id":"5305cfe.e08d53","type":"debug","z":"a9cd486b.1eae08","name":"picturetoscreen","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":640,"y":220,"wires":[]},{"id":"2b330340.f1455c","type":"function","z":"bf627e8b.92875","name":"","func":"var cleartextbox = {'payload':''}\n\nauthorized = flow.get('authorized') || false\nif(authorized===false) {\n    return [cleartextbox,null];\n}\n\nmsg.topic   = 'opentestbed/deviceType/box/deviceId/all/cmd/discovermotes'\nmsg.payload = {\n    'token': 123,\n}\nreturn [cleartextbox,msg];","outputs":2,"noerr":0,"x":290,"y":70,"wires":[["d621270f.e30a08"],["59fe9004.8262f"]]},{"id":"59fe9004.8262f","type":"mqtt out","z":"bf627e8b.92875","name":"argus","topic":"","qos":"","retain":"","broker":"327ef5a1.b4c91a","x":595,"y":155,"wires":[]},{"id":"a5cf3062.1cc3","type":"ui_button","z":"bf627e8b.92875","name":"discover","group":"83be9e0b.566e4","order":2,"width":0,"height":0,"passthru":false,"label":"discover motes","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"discovermotes","x":100,"y":70,"wires":[["2b330340.f1455c"]]},{"id":"d621270f.e30a08","type":"ui_text_input","z":"bf627e8b.92875","name":"password","label":"","group":"6155f4f4.5e5e1c","order":2,"width":"0","height":"0","passthru":true,"mode":"password","delay":"200","topic":"","x":595,"y":65,"wires":[["8f81e595.0f9b48"]]},{"id":"8f81e595.0f9b48","type":"function","z":"bf627e8b.92875","name":"autorize","func":"authorized = (msg.payload == 'poipoi')\nflow.set('authorized',authorized)\nmsg.payload = authorized;\nif(authorized) {\n    return msg;\n}\n","outputs":1,"noerr":0,"x":735,"y":65,"wires":[["c8f1dd2b.b9869"]]},{"id":"c8f1dd2b.b9869","type":"delay","z":"bf627e8b.92875","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":595,"y":105,"wires":[["bca7e70d.a89448"]]},{"id":"bca7e70d.a89448","type":"function","z":"bf627e8b.92875","name":"clear","func":"msg.payload = ''\nreturn msg;","outputs":1,"noerr":0,"x":725,"y":105,"wires":[["d621270f.e30a08"]]},{"id":"c841aafb.b04068","type":"json","z":"cdc49e9a.21798","name":"","property":"payload","action":"obj","pretty":false,"x":205,"y":240,"wires":[["10205700.9db849","8a18a03.4f6946"]]},{"id":"b4170750.f6b0b8","type":"ui_template","z":"1ada8ef0.ecb681","group":"ae851dba.90359","name":"mote list","order":0,"width":"16","height":"26","format":"<div layout=\"row\" layout-align=\"start center\">\n  <span flex>EUI64</span>\n  <span flex>testbox</span>\n  <span flex>serial</span>\n  <span flex>firmware</span>\n</div>\n<div layout=\"row\" layout-align=\"start center\" ng-repeat=\"mote in msg.payload\">\n  <span flex style=\"background-color: {{mote.bootload_success === true ? '' : 'red'}}\">{{mote.EUI64}}</span>\n  <span flex style=\"background-color: {{mote.bootload_success === true ? '' : 'red'}}\">{{mote.testbox}}</span>\n  <span flex style=\"background-color: {{mote.bootload_success === true ? '' : 'red'}}\">{{mote.serialport}}</span>\n  <span flex style=\"background-color: {{mote.bootload_success === true ? '' : 'red'}}\">{{mote.firmware_description}}</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":520,"y":140,"wires":[[]]},{"id":"ed4cf43b.244b78","type":"function","z":"1ada8ef0.ecb681","name":"","func":"flow.set('testboxlist',[])\nflow.set('motelist',[])\n\nmsg.topic   = 'opentestbed/deviceType/box/deviceId/all/cmd/status'\nmsg.payload = {\n    'token': 'motestestboxestab',\n}\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":60,"wires":[["b8f1d93a.4bbb48"]]},{"id":"b8f1d93a.4bbb48","type":"mqtt out","z":"1ada8ef0.ecb681","name":"argus","topic":"","qos":"","retain":"","broker":"327ef5a1.b4c91a","x":510,"y":60,"wires":[]},{"id":"bae6f7e0.f46a38","type":"ui_button","z":"1ada8ef0.ecb681","name":"refresh motes","group":"f093060.adc0ff8","order":2,"width":"3","height":"1","passthru":false,"label":"refresh","color":"black","bgcolor":"white","icon":"refresh","payload":"","payloadType":"str","topic":"discovermotes","x":120,"y":40,"wires":[["ed4cf43b.244b78"]]},{"id":"e35dd7d7.b25398","type":"mqtt in","z":"1ada8ef0.ecb681","name":"argus","topic":"opentestbed/#","qos":"2","broker":"327ef5a1.b4c91a","x":90,"y":160,"wires":[["ad18c31f.7ebe7"]]},{"id":"152ca953.18e977","type":"function","z":"1ada8ef0.ecb681","name":"admin","func":"var splittopic = msg.topic.split('/')\nvar returnVal  = msg.payload.returnVal; // shorthand\n\nif (\n        splittopic[5]==='resp' &&\n        splittopic[6]==='status' &&\n        msg.payload.token==='motestestboxestab'\n    ) {\n    // get flow variables\n    var motelist     = flow.get('motelist')\n    var testboxlist  = flow.get('testboxlist')\n    \n    // add motes from this status response\n    for (var i = 0; i < returnVal.motes.length; i++) {\n        var thismote = returnVal.motes[i];\n        thismote['testbox'] = splittopic[4];\n        motelist.push(thismote);\n    }\n    \n    // add testbox from this status response\n    testboxlist.push(\n        {\n            'name':                          splittopic[4],\n            'uptime':                        returnVal.uptime,\n            'software_version':              returnVal.software_version,\n            'last_changesoftware_succesful': returnVal.last_changesoftware_succesful,\n            'currenttime':                   returnVal.currenttime,\n            'starttime':                     returnVal.starttime,\n            'nummotes':                      returnVal.motes.length,\n            'numthreads':                    returnVal.threads_name.length, \n            'ip_address':                    returnVal.IP_address,\n            'location':                      returnVal.location,\n        }\n    );\n    \n    // update flow variables\n    flow.set('motelist',   motelist)\n    flow.set('testboxlist',testboxlist)\n    \n    return [\n        {'payload': motelist},\n        {'payload': testboxlist},\n    ];\n}\n\n\n","outputs":2,"noerr":0,"x":350,"y":160,"wires":[["b4170750.f6b0b8"],["d0a91da7.14ee2"]]},{"id":"ad18c31f.7ebe7","type":"json","z":"1ada8ef0.ecb681","name":"","property":"payload","action":"obj","pretty":false,"x":210,"y":160,"wires":[["152ca953.18e977"]]},{"id":"8a2ba25e.0a1c9","type":"ui_button","z":"1ada8ef0.ecb681","name":"refresh testboxes","group":"5b0686e2.1da1b8","order":2,"width":0,"height":0,"passthru":false,"label":"refresh","color":"black","bgcolor":"white","icon":"refresh","payload":"","payloadType":"str","topic":"discovermotes","x":130,"y":80,"wires":[["ed4cf43b.244b78"]]},{"id":"d0a91da7.14ee2","type":"ui_template","z":"1ada8ef0.ecb681","group":"7a042b3f.39c6e4","name":"testbox list","order":0,"width":"19","height":"22","format":"<div layout=\"row\" layout-align=\"start center\">\n  <span flex>name</span>\n  <span flex>uptime</span>\n  <span flex>version</span>\n  <span flex>currenttime</span>\n  <span flex>nummotes</span>\n  <span flex>numthreads</span>\n  <span flex>IP_address</span> \n  <span flex>location</span> \n</div>\n<div layout=\"row\" layout-align=\"start center\" ng-repeat=\"testbox in msg.payload\">\n  <span flex>{{testbox.name}}</span>\n  <span flex>{{testbox.uptime}}</span>\n  <span flex style=\"background-color: {{testbox.last_changesoftware_succesful === true ? '' : 'red'}}\">{{testbox.software_version}}</span>\n  <span flex>{{testbox.currenttime}}</span>\n  <span flex style=\"background-color: {{testbox.nummotes === 4 ? '' : 'red'}}\">{{testbox.nummotes}}</span>\n  <span flex style=\"background-color: {{testbox.numthreads === 13 ? '' : 'red'}}\">{{testbox.numthreads}}</span>\n  <span flex>{{testbox.ip_address}}</span>\n  <span flex>{{testbox.location}}</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":530,"y":180,"wires":[[]]},{"id":"e0733711.7045b8","type":"function","z":"bf627e8b.92875","name":"","func":"msg.topic   = 'opentestbed/deviceType/box/deviceId/all/cmd/hostnametoscreen'\nmsg.payload = {\n    'token': 123,\n}\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":160,"wires":[["59fe9004.8262f"]]},{"id":"61462042.e17d3","type":"ui_button","z":"bf627e8b.92875","name":"hostnametoscreen","group":"83be9e0b.566e4","order":2,"width":0,"height":0,"passthru":false,"label":"hostnametoscreen","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":125,"y":160,"wires":[["e0733711.7045b8"]]},{"id":"9da1fdc0.9b6f8","type":"ui_template","z":"cdf3f2b6.0eb2c","group":"1b9efa56.a65a36","name":"OpenWSN logo","order":0,"width":0,"height":0,"format":"<script id=\"logoTextScript\" type=\"text/javascript\">\n    var addToToolbarTimer;\n    $(function () {\n        if (addToToolbarTimer) return;\n        \n        // textdiv\n        var textdiv = $('<div/>');\n        var p       = $('<p/>');\n        p.text('OpenTestbed');\n        textdiv.append(p);\n        textdiv[0].style.margin = '10px auto';\n        \n        // logodiv\n        var logodiv = $('<div/>');\n        var logo    = new Image();\n        logo.src    = 'https://upload.wikimedia.org/wikipedia/commons/7/74/Openwsn_logo.png'\n        logo.height = 50;\n        logodiv[0].style.margin = '5px';\n        logodiv.append(logo);\n        \n        // add to toolbar when it's available\n        function addToToolbar() {\n            var toolbar = $('.md-toolbar-tools');\n            \n            if(!toolbar.length) return;\n            \n            toolbar.append(textdiv);\n            toolbar.append(logodiv);\n            clearInterval(addToToolbarTimer);\n        }\n        addToToolbarTimer = setInterval(addToToolbar, 100);\n    });\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"global","x":120,"y":60,"wires":[[]]},{"id":"efbe2f1e.864ba","type":"ui_text_input","z":"cdc49e9a.21798","name":"Firmware description","label":"Firmware Name","group":"cf023360.ebfda","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":275,"y":630,"wires":[["d2fc0115.9b5ab"]]},{"id":"d2fc0115.9b5ab","type":"function","z":"cdc49e9a.21798","name":"store firmware description","func":"flow.set('firmware_description',msg.payload)\n","outputs":1,"noerr":0,"x":535,"y":630,"wires":[[]]},{"id":"8bc2ed21.636de","type":"comment","z":"cdc49e9a.21798","name":"urldescription","info":"","x":275,"y":590,"wires":[]},{"id":"a4e075a.7dc7488","type":"inject","z":"cdc49e9a.21798","name":"","topic":"admin","payload":"all","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":400,"y":380,"wires":[["a473502c.b151"]]},{"id":"8a18a03.4f6946","type":"function","z":"cdc49e9a.21798","name":"motes_ready","func":"var splittopic = msg.topic.split('/')\n\nif (splittopic[5]==='resp' && splittopic[6]==='program') {\n    // get number of motes ready\n    var motes_ok    = flow.get('motes_program_ok')\n    var motes_notok = flow.get('motes_program_notok')\n    // add one to motes_ready\n    if(msg.payload['success'] === true)\n    {\n        motes_ok    += 1\n    }\n    else{\n        motes_notok += 1\n    }\n    // update flow variable\n    flow.set('motes_program_ok',motes_ok)\n    flow.set('motes_program_notok', motes_notok)\n    msg.motes_program_ok    = motes_ok;\n    msg.motes_program_notok = motes_notok;\n    \n    return msg;\n}\n\n\n","outputs":1,"noerr":0,"x":410,"y":240,"wires":[["589a5d17.8617f4","45a9bd87.116094"]]},{"id":"589a5d17.8617f4","type":"ui_text","z":"cdc49e9a.21798","group":"5c396642.811d08","order":1,"width":0,"height":0,"name":"","label":"Program successful","format":"{{msg.motes_program_ok}}","layout":"row-spread","x":670,"y":200,"wires":[]},{"id":"45a9bd87.116094","type":"ui_text","z":"cdc49e9a.21798","group":"5c396642.811d08","order":2,"width":0,"height":0,"name":"","label":"Program not successful","format":"{{msg.motes_program_notok}}","layout":"row-spread","x":690,"y":240,"wires":[]},{"id":"24fb3d22.a5cba2","type":"inject","z":"a9cd486b.1eae08","name":"changelocation","topic":"changelocation","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":165,"y":580,"wires":[["32e1eb36.cbcd44"]]},{"id":"32e1eb36.cbcd44","type":"function","z":"a9cd486b.1eae08","name":"payload","func":"msg.payload = {\n    'location': 'A125'\n}\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":580,"wires":[["41c2a11.1cc226"]]},{"id":"b8ef0fda.6363e","type":"mqtt in","z":"bf627e8b.92875","name":"argus","topic":"opentestbed/#","qos":"2","broker":"327ef5a1.b4c91a","x":100,"y":265,"wires":[["a59c9e05.12656"]]},{"id":"a59c9e05.12656","type":"json","z":"bf627e8b.92875","name":"","property":"payload","action":"obj","pretty":false,"x":245,"y":265,"wires":[["cd03fbbf.62dd08"]]},{"id":"cd03fbbf.62dd08","type":"function","z":"bf627e8b.92875","name":"populate otboxlist","func":"var splittopic = msg.topic.split('/')\n\nif (splittopic[5]==='resp' && splittopic[6]==='status') {\n    // get flow variable\n    var options  = flow.get('otboxlist')\n    \n    // create options for dropdown\n    options.push(splittopic[4]);\n\n    msg.options = options;\n    msg.payload = 'all';\n    \n     // update flow variable\n    flow.set('otboxlist',options)\n    return msg;\n}\n\n\n","outputs":1,"noerr":0,"x":425,"y":265,"wires":[["aa3d4b00.ad9cb8"]]},{"id":"aa3d4b00.ad9cb8","type":"ui_dropdown","z":"bf627e8b.92875","name":"","label":"","place":"select otbox","group":"1ffb0ee3.87ba21","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":625,"y":265,"wires":[["8c92a34d.7b815"]]},{"id":"8c92a34d.7b815","type":"function","z":"bf627e8b.92875","name":"store otbox name","func":"flow.set('boxtochangelocation',msg.payload)\n","outputs":1,"noerr":0,"x":805,"y":265,"wires":[[]]},{"id":"53bcfd1b.8d12f4","type":"inject","z":"bf627e8b.92875","name":"","topic":"admin","payload":"all","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":450,"y":305,"wires":[["aa3d4b00.ad9cb8"]]},{"id":"e5c09eb1.5eef9","type":"comment","z":"bf627e8b.92875","name":"use","info":"","x":600,"y":225,"wires":[]},{"id":"be5402ec.05609","type":"ui_button","z":"bf627e8b.92875","name":"refresh boxes","group":"1ffb0ee3.87ba21","order":2,"width":"3","height":"1","passthru":false,"label":"refresh","color":"black","bgcolor":"white","icon":"refresh","payload":"","payloadType":"str","topic":"discovermotes","x":115,"y":200,"wires":[["8fdf367.eca1dc8"]]},{"id":"8fdf367.eca1dc8","type":"function","z":"bf627e8b.92875","name":"","func":"flow.set('otboxlist',[])\n\nmsg.topic   = 'opentestbed/deviceType/box/deviceId/all/cmd/status'\nmsg.payload = {\n    'token': 'admintab',\n}\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":200,"wires":[["59fe9004.8262f"]]},{"id":"94530a10.9cf9a8","type":"ui_text_input","z":"bf627e8b.92875","name":"New location","label":"new location","group":"1ffb0ee3.87ba21","order":2,"width":"0","height":"0","passthru":true,"mode":"text","delay":"200","topic":"","x":120,"y":365,"wires":[["1a878dd7.6bd962"]]},{"id":"1a878dd7.6bd962","type":"function","z":"bf627e8b.92875","name":"store new location","func":"flow.set('location',msg.payload)\n","outputs":1,"noerr":0,"x":325,"y":365,"wires":[[]]},{"id":"c3bc50d0.85948","type":"function","z":"bf627e8b.92875","name":"","func":"var cleartextbox = {'payload':''}\n\nauthorized = flow.get('authorized') || false\nif(authorized===false) {\n    return [cleartextbox,null];\n}\n\nmsg.topic   = 'opentestbed/deviceType/box/deviceId/'\nmsg.topic  += flow.get('boxtochangelocation')\nmsg.topic  += '/cmd/changelocation'\nmsg.payload = {\n    'location': flow.get('location'),\n    'token':    123,\n}\nreturn [cleartextbox,msg];","outputs":2,"noerr":0,"x":290,"y":115,"wires":[["d621270f.e30a08"],["59fe9004.8262f"]]},{"id":"39e38b15.12f784","type":"ui_button","z":"bf627e8b.92875","name":"change","group":"1ffb0ee3.87ba21","order":2,"width":0,"height":0,"passthru":false,"label":"change location","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"changelocation","x":100,"y":115,"wires":[["c3bc50d0.85948"]]}]
